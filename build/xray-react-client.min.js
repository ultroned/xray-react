(function () {
  'use strict';

  const xrayReactElemCN = 'xray-react-element';
  const xrayReactCompPathAttr = 'data-xray-react-components-path';

  /**
   * Server-side constants for xray-react
   * Shared across server.js and all bundler plugins
   */


  const UI_MODE_FULL = 'full';
  const UI_MODE_SIMPLE = 'simple';
  const AVAILABLE_UI_MODES = [UI_MODE_FULL, UI_MODE_SIMPLE];

  const getIOConnectURL = () => {
    const port = (typeof window !== 'undefined' && window.__XRAY_REACT_PORT__) || 8124;
    return `http://127.0.0.1:${port}`;
  };

  /**
   * ClientIO class for handling Socket.IO connections
   */
  class ClientIO {
    constructor() {
      this.client = null;
    }

    /**
     * Dynamically loads Socket.IO client library
     * @returns {Promise<boolean>} True if loaded successfully
     */
    addScript() {
      return new Promise((resolve) => {
        if (typeof window.io !== 'undefined') {
          resolve(true);
          return;
        }

        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.async = true;
        script.src = 'https://cdn.socket.io/4.8.1/socket.io.min.js';

        script.addEventListener('load', () => {
          resolve(true);
          script.remove();
        });

        script.addEventListener('error', () => {
          console.error('xray-react: Failed to load Socket.IO client library');
          resolve(false);
          script.remove();
        });

        document.body.appendChild(script);
      });
    }

    /**
     * Initializes Socket.IO connection
     * @returns {Promise<boolean>} True if connected successfully
     */
    async init() {
      if (typeof window.io === 'undefined') {
        const isSuccess = await this.addScript();
        if (!isSuccess) {
          return false;
        }
      }

      try {
        // Socket.IO 4.x uses io() instead of io.connect()
        this.client = window.io(getIOConnectURL(), { transports: ['websocket', 'polling'] });

        this.client.on('connect', () => {
          // Connected successfully
        });

        this.client.on('disconnect', () => {
          // Disconnected from server
        });

        this.client.on('connect_error', (error) => {
          console.warn('xray-react: Connection error', error);
        });

        this.client.on('project-config', (config) => {
          if (config) {
            if (config.port && typeof window !== 'undefined') {
              window.__XRAY_REACT_PORT__ = config.port;
            }
            if (config.mode && typeof window !== 'undefined') {
              const mode = AVAILABLE_UI_MODES.includes(config.mode) ? config.mode : UI_MODE_FULL;
              window.__XRAY_REACT_MODE__ = mode;
              if (window.xrayReactSetMode) {
                window.xrayReactSetMode(mode);
              }
            }
            if (config.projectRoot) {
              if (typeof window !== 'undefined' && window.xrayReactSetProjectRoot) {
                window.xrayReactSetProjectRoot(config.projectRoot);
              } else {
                if (typeof window !== 'undefined') {
                  window.__XRAY_REACT_PROJECT_ROOT__ = config.projectRoot;
                }
              }
            }
          }
        });

        this.client.on('usage-map', (data) => {
          if (data && data.usage) {
            if (typeof window !== 'undefined' && window.xrayReactSetUsageMap) {
              window.xrayReactSetUsageMap(data.usage);
            } else {
              if (typeof window !== 'undefined') {
                window.__XRAY_REACT_USAGE_MAP__ = data.usage;
              }
            }
          }
        });

        this.client.on('import-map', (data) => {
          if (data && data.imports) {
            if (typeof window !== 'undefined' && window.xrayReactSetImportMap) {
              window.xrayReactSetImportMap(data.imports);
            } else {
              if (typeof window !== 'undefined') {
                window.__XRAY_REACT_IMPORT_MAP__ = data.imports;
              }
            }
          }
        });

        this.client.on('project-files', (data) => {
          if (data && data.files) {
            if (typeof window !== 'undefined' && window.xrayReactSetProjectFiles) {
              window.xrayReactSetProjectFiles(data.files);
            } else {
              if (typeof window !== 'undefined') {
                window.__XRAY_REACT_PROJECT_FILES__ = data.files;
              }
            }
          }
        });

        return true;
      } catch (error) {
        console.error('xray-react: Failed to initialize Socket.IO', error);
        return false;
      }
    }
  }

  /**
   * Initializes Socket.IO and sets up click listeners
   */
  const initIOAndListeners = async () => {
    const clientIO = new ClientIO();
    const isSuccess = await clientIO.init();

    if (isSuccess) {
      document.body.addEventListener('click', (event) => {
        const target = event.target;
        if (target.classList.contains(xrayReactElemCN)) {
          const componentPath = target.getAttribute(xrayReactCompPathAttr);
          if (componentPath && clientIO.client) {
            clientIO.client.emit('xray-react-component', componentPath);
          }
        }
      });
    }
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initIOAndListeners);
  } else {
    initIOAndListeners();
  }

})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHJheS1yZWFjdC1jbGllbnQubWluLmpzIiwic291cmNlcyI6WyIuLi9zcmMvY29uc3RhbnRzLmpzIiwiLi4vbGliL2NvbnN0YW50cy5qcyIsIi4uL2xpYi94cmF5LXJlYWN0LWNsaWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgeHJheVJlYWN0RWxlbUNOID0gJ3hyYXktcmVhY3QtZWxlbWVudCc7XG5leHBvcnQgY29uc3QgeHJheVJlYWN0V3JhcHBlckNOID0gJ3hyYXktcmVhY3QtZWxlbWVudHMtd3JhcHBlcic7XG5leHBvcnQgY29uc3QgeHJheVJlYWN0Q29tcFBhdGhBdHRyID0gJ2RhdGEteHJheS1yZWFjdC1jb21wb25lbnRzLXBhdGgnO1xuZXhwb3J0IGNvbnN0IHhyYXlSZWFjdEZpbHRlcmVkQ29tcFBhdGhBdHRyID0gJ2RhdGEteHJheS1yZWFjdC1maWx0ZXJlZC1jb21wb25lbnRzLXBhdGgnO1xuZXhwb3J0IGNvbnN0IHpJbmRleCA9IDEwMDAwO1xuXG5leHBvcnQgY29uc3QgVUlfTU9ERV9GVUxMID0gJ2Z1bGwnO1xuZXhwb3J0IGNvbnN0IFVJX01PREVfU0lNUExFID0gJ3NpbXBsZSc7XG5leHBvcnQgY29uc3QgQVZBSUxBQkxFX1VJX01PREVTID0gW1VJX01PREVfRlVMTCwgVUlfTU9ERV9TSU1QTEVdO1xuXG5leHBvcnQgY29uc3QgSFRNTF9FTEVNRU5UUyA9IG5ldyBTZXQoW1xuICAnZGl2JyxcbiAgJ3NwYW4nLFxuICAnZm9ybScsXG4gICdidXR0b24nLFxuICAnaW5wdXQnLFxuICAnYScsXG4gICdpbWcnLFxuICAncCcsXG4gICdoMScsXG4gICdoMicsXG4gICdoMycsXG4gICdoNCcsXG4gICdoNScsXG4gICdoNicsXG4gICd1bCcsXG4gICdsaScsXG4gICdvbCcsXG4gICd0YWJsZScsXG4gICd0cicsXG4gICd0ZCcsXG4gICd0aCcsXG4gICd0aGVhZCcsXG4gICd0Ym9keScsXG4gICd0Zm9vdCcsXG4gICdzZWN0aW9uJyxcbiAgJ2FydGljbGUnLFxuICAnaGVhZGVyJyxcbiAgJ2Zvb3RlcicsXG4gICduYXYnLFxuICAnbWFpbicsXG4gICdhc2lkZScsXG4gICdsYWJlbCcsXG4gICdzZWxlY3QnLFxuICAnb3B0aW9uJyxcbiAgJ3RleHRhcmVhJyxcbiAgJ2ZpZWxkc2V0JyxcbiAgJ2xlZ2VuZCcsXG4gICdicicsXG4gICdocicsXG4gICdzdHJvbmcnLFxuICAnZW0nLFxuICAnYicsXG4gICdpJyxcbiAgJ3UnLFxuICAnc21hbGwnLFxuICAnc3ViJyxcbiAgJ3N1cCcsXG4gICdkbCcsXG4gICdkdCcsXG4gICdkZCcsXG4gICdwcmUnLFxuICAnY29kZScsXG4gICdibG9ja3F1b3RlJyxcbiAgJ2NpdGUnLFxuICAnY2FudmFzJyxcbiAgJ3N2ZycsXG4gICdwYXRoJyxcbiAgJ2NpcmNsZScsXG4gICdyZWN0JyxcbiAgJ2xpbmUnLFxuICAncG9seWxpbmUnLFxuICAncG9seWdvbicsXG4gICdpZnJhbWUnLFxuICAnZW1iZWQnLFxuICAnb2JqZWN0JyxcbiAgJ3ZpZGVvJyxcbiAgJ2F1ZGlvJyxcbiAgJ3NvdXJjZScsXG4gICd0cmFjaycsXG4gICdtZXRhJyxcbiAgJ2xpbmsnLFxuICAnc3R5bGUnLFxuICAnc2NyaXB0JyxcbiAgJ25vc2NyaXB0JyxcbiAgJ3RlbXBsYXRlJyxcbl0pO1xuIiwiLyoqXG4gKiBTZXJ2ZXItc2lkZSBjb25zdGFudHMgZm9yIHhyYXktcmVhY3RcbiAqIFNoYXJlZCBhY3Jvc3Mgc2VydmVyLmpzIGFuZCBhbGwgYnVuZGxlciBwbHVnaW5zXG4gKi9cblxuZXhwb3J0IGNvbnN0IFJFQUNUX0ZJTEVfRVhUUyA9IFsnLmpzeCcsICcuanMnLCAnLnRzeCcsICcudHMnXTtcblxuZXhwb3J0IGNvbnN0IFVJX01PREVfRlVMTCA9ICdmdWxsJztcbmV4cG9ydCBjb25zdCBVSV9NT0RFX1NJTVBMRSA9ICdzaW1wbGUnO1xuZXhwb3J0IGNvbnN0IEFWQUlMQUJMRV9VSV9NT0RFUyA9IFtVSV9NT0RFX0ZVTEwsIFVJX01PREVfU0lNUExFXTtcblxuZXhwb3J0IGNvbnN0IEVYQ0xVREVEX0ZJTEVfUEFUVEVSTlMgPSBbXG4gIC9cXC5zdHlsZXNcXC4odHN8anN8dHN4fGpzeCkkL2ksXG4gIC9cXC5zdHlsZVxcLih0c3xqc3x0c3h8anN4KSQvaSxcbiAgL1xcLnN0eWxcXC4odHN8anN8dHN4fGpzeCkkL2ksXG4gIC9cXC5jc3NcXC4odHN8anN8dHN4fGpzeCkkL2ksXG4gIC9cXC50ZXN0XFwuKHRzfGpzfHRzeHxqc3gpJC9pLFxuICAvXFwuc3BlY1xcLih0c3xqc3x0c3h8anN4KSQvaSxcbiAgL1xcLmRcXC50cyQvaSwgLy8gVHlwZVNjcmlwdCBkZWNsYXJhdGlvbiBmaWxlc1xuXTtcblxuZXhwb3J0IGNvbnN0IEhUTUxfRUxFTUVOVFMgPSBbXG4gICdkaXYnLFxuICAnc3BhbicsXG4gICdmb3JtJyxcbiAgJ2J1dHRvbicsXG4gICdpbnB1dCcsXG4gICdhJyxcbiAgJ2ltZycsXG4gICdwJyxcbiAgJ2gxJyxcbiAgJ2gyJyxcbiAgJ2gzJyxcbiAgJ2g0JyxcbiAgJ2g1JyxcbiAgJ2g2JyxcbiAgJ3VsJyxcbiAgJ2xpJyxcbiAgJ29sJyxcbiAgJ3RhYmxlJyxcbiAgJ3RyJyxcbiAgJ3RkJyxcbiAgJ3RoJyxcbiAgJ3RoZWFkJyxcbiAgJ3Rib2R5JyxcbiAgJ3NlY3Rpb24nLFxuICAnYXJ0aWNsZScsXG4gICdoZWFkZXInLFxuICAnZm9vdGVyJyxcbiAgJ25hdicsXG4gICdtYWluJyxcbiAgJ2FzaWRlJyxcbiAgJ2JyJyxcbiAgJ2hyJyxcbiAgJ3N0cm9uZycsXG4gICdlbScsXG4gICdiJyxcbiAgJ2knLFxuICAndScsXG4gICdsYWJlbCcsXG4gICdzZWxlY3QnLFxuICAnb3B0aW9uJyxcbiAgJ3RleHRhcmVhJyxcbiAgJ2ZpZWxkc2V0JyxcbiAgJ2xlZ2VuZCcsXG4gICdjYW52YXMnLFxuICAnc3ZnJyxcbiAgJ3BhdGgnLFxuICAnY2lyY2xlJyxcbiAgJ3JlY3QnLFxuICAnbGluZScsXG5dO1xuXG5leHBvcnQgY29uc3QgSlNfS0VZV09SRFMgPSBbXG4gICdmdW5jdGlvbicsXG4gICdjb25zdCcsXG4gICdsZXQnLFxuICAndmFyJyxcbiAgJ2NsYXNzJyxcbiAgJ2ludGVyZmFjZScsXG4gICd0eXBlJyxcbiAgJ2VudW0nLFxuICAnZXhwb3J0JyxcbiAgJ2ltcG9ydCcsXG4gICdkZWZhdWx0JyxcbiAgJ3JldHVybicsXG4gICdpZicsXG4gICdlbHNlJyxcbiAgJ2ZvcicsXG4gICd3aGlsZScsXG4gICdzd2l0Y2gnLFxuICAnY2FzZScsXG4gICdicmVhaycsXG4gICdjb250aW51ZScsXG4gICd0cnknLFxuICAnY2F0Y2gnLFxuICAnZmluYWxseScsXG4gICd0aHJvdycsXG4gICduZXcnLFxuICAndGhpcycsXG4gICdzdXBlcicsXG4gICdleHRlbmRzJyxcbiAgJ2ltcGxlbWVudHMnLFxuICAnc3RhdGljJyxcbiAgJ2FzeW5jJyxcbiAgJ2F3YWl0JyxcbiAgJ3Byb21pc2UnLFxuICAnYXJyYXknLFxuICAnb2JqZWN0JyxcbiAgJ3N0cmluZycsXG4gICdudW1iZXInLFxuICAnYm9vbGVhbicsXG4gICdudWxsJyxcbiAgJ3VuZGVmaW5lZCcsXG4gICd2b2lkJyxcbl07XG5cbmV4cG9ydCBjb25zdCBDT01NT05fU09VUkNFX0RJUlMgPSBbXG4gIC8vIFByb2plY3Qgc3RydWN0dXJlXG4gICdzcmMnLFxuICAnYXBwJyxcbiAgJ2xpYicsXG4gICd1dGlscycsXG4gIC8vIEF0b21pYy9VSSBjb21wb25lbnRzXG4gICdhdG9tcycsXG4gICd1aScsXG4gIC8vIFNoYXJlZC9jb21tb24gY29tcG9uZW50c1xuICAnY29tbW9uJyxcbiAgJ3NoYXJlZCcsXG4gIC8vIENvbXBvbmVudCBvcmdhbml6YXRpb25cbiAgJ2NvbXBvbmVudHMnLFxuICAnc2VjdGlvbnMnLFxuICAnZm9ybXMnLFxuICAnY29udGFpbmVycycsXG4gIC8vIExheW91dHMgYW5kIHRlbXBsYXRlc1xuICAnbGF5b3V0cycsXG4gICd0ZW1wbGF0ZXMnLFxuICAvLyBWaWV3cyBhbmQgcGFnZXNcbiAgJ3ZpZXdzJyxcbiAgJ3NjcmVlbnMnLFxuICAncGFnZXMnLFxuXTtcbiIsImltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tICcuLi9zcmMvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFVJX01PREVfRlVMTCwgQVZBSUxBQkxFX1VJX01PREVTIH0gZnJvbSAnLi4vbGliL2NvbnN0YW50cy5qcyc7XG5cbmNvbnN0IGdldElPQ29ubmVjdFVSTCA9ICgpID0+IHtcbiAgY29uc3QgcG9ydCA9ICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuX19YUkFZX1JFQUNUX1BPUlRfXykgfHwgODEyNDtcbiAgcmV0dXJuIGBodHRwOi8vMTI3LjAuMC4xOiR7cG9ydH1gO1xufTtcblxuLyoqXG4gKiBDbGllbnRJTyBjbGFzcyBmb3IgaGFuZGxpbmcgU29ja2V0LklPIGNvbm5lY3Rpb25zXG4gKi9cbmNsYXNzIENsaWVudElPIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jbGllbnQgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIER5bmFtaWNhbGx5IGxvYWRzIFNvY2tldC5JTyBjbGllbnQgbGlicmFyeVxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiBsb2FkZWQgc3VjY2Vzc2Z1bGx5XG4gICAqL1xuICBhZGRTY3JpcHQoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIHdpbmRvdy5pbyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlO1xuICAgICAgc2NyaXB0LnNyYyA9ICdodHRwczovL2Nkbi5zb2NrZXQuaW8vNC44LjEvc29ja2V0LmlvLm1pbi5qcyc7XG5cbiAgICAgIHNjcmlwdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICBzY3JpcHQucmVtb3ZlKCk7XG4gICAgICB9KTtcblxuICAgICAgc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKCd4cmF5LXJlYWN0OiBGYWlsZWQgdG8gbG9hZCBTb2NrZXQuSU8gY2xpZW50IGxpYnJhcnknKTtcbiAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIHNjcmlwdC5yZW1vdmUoKTtcbiAgICAgIH0pO1xuXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgU29ja2V0LklPIGNvbm5lY3Rpb25cbiAgICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IFRydWUgaWYgY29ubmVjdGVkIHN1Y2Nlc3NmdWxseVxuICAgKi9cbiAgYXN5bmMgaW5pdCgpIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdy5pbyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGNvbnN0IGlzU3VjY2VzcyA9IGF3YWl0IHRoaXMuYWRkU2NyaXB0KCk7XG4gICAgICBpZiAoIWlzU3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFNvY2tldC5JTyA0LnggdXNlcyBpbygpIGluc3RlYWQgb2YgaW8uY29ubmVjdCgpXG4gICAgICB0aGlzLmNsaWVudCA9IHdpbmRvdy5pbyhnZXRJT0Nvbm5lY3RVUkwoKSwgeyB0cmFuc3BvcnRzOiBbJ3dlYnNvY2tldCcsICdwb2xsaW5nJ10gfSk7XG5cbiAgICAgIHRoaXMuY2xpZW50Lm9uKCdjb25uZWN0JywgKCkgPT4ge1xuICAgICAgICAvLyBDb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5jbGllbnQub24oJ2Rpc2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICAgIC8vIERpc2Nvbm5lY3RlZCBmcm9tIHNlcnZlclxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY2xpZW50Lm9uKCdjb25uZWN0X2Vycm9yJywgKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUud2FybigneHJheS1yZWFjdDogQ29ubmVjdGlvbiBlcnJvcicsIGVycm9yKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbigncHJvamVjdC1jb25maWcnLCAoY29uZmlnKSA9PiB7XG4gICAgICAgIGlmIChjb25maWcpIHtcbiAgICAgICAgICBpZiAoY29uZmlnLnBvcnQgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHdpbmRvdy5fX1hSQVlfUkVBQ1RfUE9SVF9fID0gY29uZmlnLnBvcnQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjb25maWcubW9kZSAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgY29uc3QgbW9kZSA9IEFWQUlMQUJMRV9VSV9NT0RFUy5pbmNsdWRlcyhjb25maWcubW9kZSkgPyBjb25maWcubW9kZSA6IFVJX01PREVfRlVMTDtcbiAgICAgICAgICAgIHdpbmRvdy5fX1hSQVlfUkVBQ1RfTU9ERV9fID0gbW9kZTtcbiAgICAgICAgICAgIGlmICh3aW5kb3cueHJheVJlYWN0U2V0TW9kZSkge1xuICAgICAgICAgICAgICB3aW5kb3cueHJheVJlYWN0U2V0TW9kZShtb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGNvbmZpZy5wcm9qZWN0Um9vdCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy54cmF5UmVhY3RTZXRQcm9qZWN0Um9vdCkge1xuICAgICAgICAgICAgICB3aW5kb3cueHJheVJlYWN0U2V0UHJvamVjdFJvb3QoY29uZmlnLnByb2plY3RSb290KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5fX1hSQVlfUkVBQ1RfUFJPSkVDVF9ST09UX18gPSBjb25maWcucHJvamVjdFJvb3Q7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbigndXNhZ2UtbWFwJywgKGRhdGEpID0+IHtcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS51c2FnZSkge1xuICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cueHJheVJlYWN0U2V0VXNhZ2VNYXApIHtcbiAgICAgICAgICAgIHdpbmRvdy54cmF5UmVhY3RTZXRVc2FnZU1hcChkYXRhLnVzYWdlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgIHdpbmRvdy5fX1hSQVlfUkVBQ1RfVVNBR0VfTUFQX18gPSBkYXRhLnVzYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY2xpZW50Lm9uKCdpbXBvcnQtbWFwJywgKGRhdGEpID0+IHtcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5pbXBvcnRzKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy54cmF5UmVhY3RTZXRJbXBvcnRNYXApIHtcbiAgICAgICAgICAgIHdpbmRvdy54cmF5UmVhY3RTZXRJbXBvcnRNYXAoZGF0YS5pbXBvcnRzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgIHdpbmRvdy5fX1hSQVlfUkVBQ1RfSU1QT1JUX01BUF9fID0gZGF0YS5pbXBvcnRzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY2xpZW50Lm9uKCdwcm9qZWN0LWZpbGVzJywgKGRhdGEpID0+IHtcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5maWxlcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cueHJheVJlYWN0U2V0UHJvamVjdEZpbGVzKSB7XG4gICAgICAgICAgICB3aW5kb3cueHJheVJlYWN0U2V0UHJvamVjdEZpbGVzKGRhdGEuZmlsZXMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgd2luZG93Ll9fWFJBWV9SRUFDVF9QUk9KRUNUX0ZJTEVTX18gPSBkYXRhLmZpbGVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCd4cmF5LXJlYWN0OiBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBTb2NrZXQuSU8nLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgU29ja2V0LklPIGFuZCBzZXRzIHVwIGNsaWNrIGxpc3RlbmVyc1xuICovXG5jb25zdCBpbml0SU9BbmRMaXN0ZW5lcnMgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGNsaWVudElPID0gbmV3IENsaWVudElPKCk7XG4gIGNvbnN0IGlzU3VjY2VzcyA9IGF3YWl0IGNsaWVudElPLmluaXQoKTtcblxuICBpZiAoaXNTdWNjZXNzKSB7XG4gICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoY29uc3RhbnRzLnhyYXlSZWFjdEVsZW1DTikpIHtcbiAgICAgICAgY29uc3QgY29tcG9uZW50UGF0aCA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoY29uc3RhbnRzLnhyYXlSZWFjdENvbXBQYXRoQXR0cik7XG4gICAgICAgIGlmIChjb21wb25lbnRQYXRoICYmIGNsaWVudElPLmNsaWVudCkge1xuICAgICAgICAgIGNsaWVudElPLmNsaWVudC5lbWl0KCd4cmF5LXJlYWN0LWNvbXBvbmVudCcsIGNvbXBvbmVudFBhdGgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnbG9hZGluZycpIHtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGluaXRJT0FuZExpc3RlbmVycyk7XG59IGVsc2Uge1xuICBpbml0SU9BbmRMaXN0ZW5lcnMoKTtcbn1cbiJdLCJuYW1lcyI6WyJjb25zdGFudHMueHJheVJlYWN0RWxlbUNOIiwiY29uc3RhbnRzLnhyYXlSZWFjdENvbXBQYXRoQXR0ciJdLCJtYXBwaW5ncyI6Ijs7O0VBQU8sTUFBTSxlQUFlLEdBQUcsb0JBQW9CO0VBRTVDLE1BQU0scUJBQXFCLEdBQUcsaUNBQWlDOztFQ0Z0RTtFQUNBO0VBQ0E7RUFDQTs7O0VBSU8sTUFBTSxZQUFZLEdBQUcsTUFBTTtFQUMzQixNQUFNLGNBQWMsR0FBRyxRQUFRO0VBQy9CLE1BQU0sa0JB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
