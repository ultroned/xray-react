(function () {
  'use strict';

  const xrayReactElemCN = 'xray-react-element';
  const xrayReactCompPathAttr = 'data-xray-react-components-path';

  /**
   * Server-side constants for xray-react
   * Shared across server.js and all bundler plugins
   */


  const UI_MODE_FULL = 'full';
  const UI_MODE_SIMPLE = 'simple';
  const AVAILABLE_UI_MODES = [UI_MODE_FULL, UI_MODE_SIMPLE];

  const getIOConnectURL = () => {
    const port = (typeof window !== 'undefined' && window.__XRAY_REACT_PORT__) || 8124;
    return `http://127.0.0.1:${port}`;
  };

  /**
   * ClientIO class for handling Socket.IO connections
   */
  class ClientIO {
    constructor() {
      this.client = null;
    }

    /**
     * Dynamically loads Socket.IO client library
     * @returns {Promise<boolean>} True if loaded successfully
     */
    addScript() {
      return new Promise((resolve) => {
        if (typeof window.io !== 'undefined') {
          resolve(true);
          return;
        }

        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.async = true;
        script.src = 'https://cdn.socket.io/4.8.1/socket.io.min.js';

        script.addEventListener('load', () => {
          resolve(true);
          script.remove();
        });

        script.addEventListener('error', () => {
          console.error('xray-react: Failed to load Socket.IO client library');
          resolve(false);
          script.remove();
        });

        document.body.appendChild(script);
      });
    }

    /**
     * Initializes Socket.IO connection
     * @returns {Promise<boolean>} True if connected successfully
     */
    async init() {
      if (typeof window.io === 'undefined') {
        const isSuccess = await this.addScript();
        if (!isSuccess) {
          return false;
        }
      }

      try {
        // Socket.IO 4.x uses io() instead of io.connect()
        this.client = window.io(getIOConnectURL(), {
          transports: ['websocket', 'polling']
        });

        this.client.on('connect', () => {
          // Connected successfully
        });

        this.client.on('disconnect', () => {
          // Disconnected from server
        });

        this.client.on('connect_error', (error) => {
          console.warn('xray-react: Connection error', error);
        });

        this.client.on('project-config', (config) => {
          if (config) {
            if (config.port && typeof window !== 'undefined') {
              window.__XRAY_REACT_PORT__ = config.port;
            }
            if (config.mode && typeof window !== 'undefined') {
              const mode = AVAILABLE_UI_MODES.includes(config.mode) ? config.mode : UI_MODE_FULL;
              window.__XRAY_REACT_MODE__ = mode;
              if (window.xrayReactSetMode) {
                window.xrayReactSetMode(mode);
              }
            }
            if (config.projectRoot) {
              if (typeof window !== 'undefined' && window.xrayReactSetProjectRoot) {
                window.xrayReactSetProjectRoot(config.projectRoot);
              } else {
                if (typeof window !== 'undefined') {
                  window.__XRAY_REACT_PROJECT_ROOT__ = config.projectRoot;
                }
              }
            }
          }
        });

        this.client.on('usage-map', (data) => {
          if (data && data.usage) {
            if (typeof window !== 'undefined' && window.xrayReactSetUsageMap) {
              window.xrayReactSetUsageMap(data.usage);
            } else {
              if (typeof window !== 'undefined') {
                window.__XRAY_REACT_USAGE_MAP__ = data.usage;
              }
            }
          }
        });

        this.client.on('import-map', (data) => {
          if (data && data.imports) {
            if (typeof window !== 'undefined' && window.xrayReactSetImportMap) {
              window.xrayReactSetImportMap(data.imports);
            } else {
              if (typeof window !== 'undefined') {
                window.__XRAY_REACT_IMPORT_MAP__ = data.imports;
              }
            }
          }
        });

        this.client.on('project-files', (data) => {
          if (data && data.files) {
            if (typeof window !== 'undefined' && window.xrayReactSetProjectFiles) {
              window.xrayReactSetProjectFiles(data.files);
            } else {
              if (typeof window !== 'undefined') {
                window.__XRAY_REACT_PROJECT_FILES__ = data.files;
              }
            }
          }
        });

        return true;
      } catch (error) {
        console.error('xray-react: Failed to initialize Socket.IO', error);
        return false;
      }
    }
  }

  /**
   * Initializes Socket.IO and sets up click listeners
   */
  const initIOAndListeners = async () => {
    const clientIO = new ClientIO();
    const isSuccess = await clientIO.init();

    if (isSuccess) {
      document.body.addEventListener('click', (event) => {
        const target = event.target;
        if (target.classList.contains(xrayReactElemCN)) {
          const componentPath = target.getAttribute(xrayReactCompPathAttr);
          if (componentPath && clientIO.client) {
            clientIO.client.emit('xray-react-component', componentPath);
          }
        }
      });
    }
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initIOAndListeners);
  } else {
    initIOAndListeners();
  }

})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHJheS1yZWFjdC1jbGllbnQubWluLmpzIiwic291cmNlcyI6WyIuLi9zcmMvY29uc3RhbnRzLmpzIiwiLi4vbGliL2NvbnN0YW50cy5qcyIsIi4uL2xpYi94cmF5LXJlYWN0LWNsaWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgeHJheVJlYWN0RWxlbUNOID0gJ3hyYXktcmVhY3QtZWxlbWVudCc7XG5leHBvcnQgY29uc3QgeHJheVJlYWN0V3JhcHBlckNOID0gJ3hyYXktcmVhY3QtZWxlbWVudHMtd3JhcHBlcic7XG5leHBvcnQgY29uc3QgeHJheVJlYWN0Q29tcFBhdGhBdHRyID0gJ2RhdGEteHJheS1yZWFjdC1jb21wb25lbnRzLXBhdGgnO1xuZXhwb3J0IGNvbnN0IHhyYXlSZWFjdEZpbHRlcmVkQ29tcFBhdGhBdHRyID0gJ2RhdGEteHJheS1yZWFjdC1maWx0ZXJlZC1jb21wb25lbnRzLXBhdGgnO1xuZXhwb3J0IGNvbnN0IHpJbmRleCA9IDEwMDAwO1xuXG5leHBvcnQgY29uc3QgVUlfTU9ERV9GVUxMID0gJ2Z1bGwnO1xuZXhwb3J0IGNvbnN0IFVJX01PREVfU0lNUExFID0gJ3NpbXBsZSc7XG5leHBvcnQgY29uc3QgQVZBSUxBQkxFX1VJX01PREVTID0gW1VJX01PREVfRlVMTCwgVUlfTU9ERV9TSU1QTEVdO1xuXG5leHBvcnQgY29uc3QgSFRNTF9FTEVNRU5UUyA9IG5ldyBTZXQoW1xuICAnZGl2JywgJ3NwYW4nLCAnZm9ybScsICdidXR0b24nLCAnaW5wdXQnLCAnYScsICdpbWcnLCAncCcsICdoMScsICdoMicsICdoMycsICdoNCcsICdoNScsICdoNicsXG4gICd1bCcsICdsaScsICdvbCcsICd0YWJsZScsICd0cicsICd0ZCcsICd0aCcsICd0aGVhZCcsICd0Ym9keScsICd0Zm9vdCcsXG4gICdzZWN0aW9uJywgJ2FydGljbGUnLCAnaGVhZGVyJywgJ2Zvb3RlcicsICduYXYnLCAnbWFpbicsICdhc2lkZScsXG4gICdsYWJlbCcsICdzZWxlY3QnLCAnb3B0aW9uJywgJ3RleHRhcmVhJywgJ2ZpZWxkc2V0JywgJ2xlZ2VuZCcsXG4gICdicicsICdocicsICdzdHJvbmcnLCAnZW0nLCAnYicsICdpJywgJ3UnLCAnc21hbGwnLCAnc3ViJywgJ3N1cCcsXG4gICdkbCcsICdkdCcsICdkZCcsICdwcmUnLCAnY29kZScsICdibG9ja3F1b3RlJywgJ2NpdGUnLFxuICAnY2FudmFzJywgJ3N2ZycsICdwYXRoJywgJ2NpcmNsZScsICdyZWN0JywgJ2xpbmUnLCAncG9seWxpbmUnLCAncG9seWdvbicsXG4gICdpZnJhbWUnLCAnZW1iZWQnLCAnb2JqZWN0JywgJ3ZpZGVvJywgJ2F1ZGlvJywgJ3NvdXJjZScsICd0cmFjaycsXG4gICdtZXRhJywgJ2xpbmsnLCAnc3R5bGUnLCAnc2NyaXB0JywgJ25vc2NyaXB0JywgJ3RlbXBsYXRlJ1xuXSk7XG4iLCIvKipcbiAqIFNlcnZlci1zaWRlIGNvbnN0YW50cyBmb3IgeHJheS1yZWFjdFxuICogU2hhcmVkIGFjcm9zcyBzZXJ2ZXIuanMgYW5kIGFsbCBidW5kbGVyIHBsdWdpbnNcbiAqL1xuXG5leHBvcnQgY29uc3QgUkVBQ1RfRklMRV9FWFRTID0gWycuanN4JywgJy5qcycsICcudHN4JywgJy50cyddO1xuXG5leHBvcnQgY29uc3QgVUlfTU9ERV9GVUxMID0gJ2Z1bGwnO1xuZXhwb3J0IGNvbnN0IFVJX01PREVfU0lNUExFID0gJ3NpbXBsZSc7XG5leHBvcnQgY29uc3QgQVZBSUxBQkxFX1VJX01PREVTID0gW1VJX01PREVfRlVMTCwgVUlfTU9ERV9TSU1QTEVdO1xuXG5leHBvcnQgY29uc3QgRVhDTFVERURfRklMRV9QQVRURVJOUyA9IFtcbiAgL1xcLnN0eWxlc1xcLih0c3xqc3x0c3h8anN4KSQvaSxcbiAgL1xcLnN0eWxlXFwuKHRzfGpzfHRzeHxqc3gpJC9pLFxuICAvXFwuc3R5bFxcLih0c3xqc3x0c3h8anN4KSQvaSxcbiAgL1xcLmNzc1xcLih0c3xqc3x0c3h8anN4KSQvaSxcbiAgL1xcLnRlc3RcXC4odHN8anN8dHN4fGpzeCkkL2ksXG4gIC9cXC5zcGVjXFwuKHRzfGpzfHRzeHxqc3gpJC9pLFxuICAvXFwuZFxcLnRzJC9pLCAvLyBUeXBlU2NyaXB0IGRlY2xhcmF0aW9uIGZpbGVzXG5dO1xuXG5leHBvcnQgY29uc3QgSFRNTF9FTEVNRU5UUyA9IFtcbiAgJ2RpdicsICdzcGFuJywgJ2Zvcm0nLCAnYnV0dG9uJywgJ2lucHV0JywgJ2EnLCAnaW1nJywgJ3AnLCAnaDEnLCAnaDInLCAnaDMnLCAnaDQnLCAnaDUnLCAnaDYnLFxuICAndWwnLCAnbGknLCAnb2wnLCAndGFibGUnLCAndHInLCAndGQnLCAndGgnLCAndGhlYWQnLCAndGJvZHknLCAnc2VjdGlvbicsICdhcnRpY2xlJywgJ2hlYWRlcicsXG4gICdmb290ZXInLCAnbmF2JywgJ21haW4nLCAnYXNpZGUnLCAnYnInLCAnaHInLCAnc3Ryb25nJywgJ2VtJywgJ2InLCAnaScsICd1JywgJ2xhYmVsJywgJ3NlbGVjdCcsXG4gICdvcHRpb24nLCAndGV4dGFyZWEnLCAnZmllbGRzZXQnLCAnbGVnZW5kJywgJ2NhbnZhcycsICdzdmcnLCAncGF0aCcsICdjaXJjbGUnLCAncmVjdCcsICdsaW5lJ1xuXTtcblxuZXhwb3J0IGNvbnN0IEpTX0tFWVdPUkRTID0gW1xuICAnZnVuY3Rpb24nLCAnY29uc3QnLCAnbGV0JywgJ3ZhcicsICdjbGFzcycsICdpbnRlcmZhY2UnLCAndHlwZScsICdlbnVtJywgJ2V4cG9ydCcsICdpbXBvcnQnLFxuICAnZGVmYXVsdCcsICdyZXR1cm4nLCAnaWYnLCAnZWxzZScsICdmb3InLCAnd2hpbGUnLCAnc3dpdGNoJywgJ2Nhc2UnLCAnYnJlYWsnLCAnY29udGludWUnLFxuICAndHJ5JywgJ2NhdGNoJywgJ2ZpbmFsbHknLCAndGhyb3cnLCAnbmV3JywgJ3RoaXMnLCAnc3VwZXInLCAnZXh0ZW5kcycsICdpbXBsZW1lbnRzJywgJ3N0YXRpYycsXG4gICdhc3luYycsICdhd2FpdCcsICdwcm9taXNlJywgJ2FycmF5JywgJ29iamVjdCcsICdzdHJpbmcnLCAnbnVtYmVyJywgJ2Jvb2xlYW4nLCAnbnVsbCcsXG4gICd1bmRlZmluZWQnLCAndm9pZCdcbl07XG5cbmV4cG9ydCBjb25zdCBDT01NT05fU09VUkNFX0RJUlMgPSBbXG4gIC8vIFByb2plY3Qgc3RydWN0dXJlXG4gICdzcmMnLFxuICAnYXBwJyxcbiAgJ2xpYicsXG4gICd1dGlscycsXG4gIC8vIEF0b21pYy9VSSBjb21wb25lbnRzXG4gICdhdG9tcycsXG4gICd1aScsXG4gIC8vIFNoYXJlZC9jb21tb24gY29tcG9uZW50c1xuICAnY29tbW9uJyxcbiAgJ3NoYXJlZCcsXG4gIC8vIENvbXBvbmVudCBvcmdhbml6YXRpb25cbiAgJ2NvbXBvbmVudHMnLFxuICAnc2VjdGlvbnMnLFxuICAnZm9ybXMnLFxuICAnY29udGFpbmVycycsXG4gIC8vIExheW91dHMgYW5kIHRlbXBsYXRlc1xuICAnbGF5b3V0cycsXG4gICd0ZW1wbGF0ZXMnLFxuICAvLyBWaWV3cyBhbmQgcGFnZXNcbiAgJ3ZpZXdzJyxcbiAgJ3NjcmVlbnMnLFxuICAncGFnZXMnLFxuXTtcbiIsImltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tICcuLi9zcmMvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFVJX01PREVfRlVMTCwgQVZBSUxBQkxFX1VJX01PREVTIH0gZnJvbSAnLi4vbGliL2NvbnN0YW50cy5qcyc7XG5cbmNvbnN0IGdldElPQ29ubmVjdFVSTCA9ICgpID0+IHtcbiAgY29uc3QgcG9ydCA9ICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuX19YUkFZX1JFQUNUX1BPUlRfXykgfHwgODEyNDtcbiAgcmV0dXJuIGBodHRwOi8vMTI3LjAuMC4xOiR7cG9ydH1gO1xufTtcblxuLyoqXG4gKiBDbGllbnRJTyBjbGFzcyBmb3IgaGFuZGxpbmcgU29ja2V0LklPIGNvbm5lY3Rpb25zXG4gKi9cbmNsYXNzIENsaWVudElPIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jbGllbnQgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIER5bmFtaWNhbGx5IGxvYWRzIFNvY2tldC5JTyBjbGllbnQgbGlicmFyeVxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiBsb2FkZWQgc3VjY2Vzc2Z1bGx5XG4gICAqL1xuICBhZGRTY3JpcHQoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIHdpbmRvdy5pbyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlO1xuICAgICAgc2NyaXB0LnNyYyA9ICdodHRwczovL2Nkbi5zb2NrZXQuaW8vNC44LjEvc29ja2V0LmlvLm1pbi5qcyc7XG5cbiAgICAgIHNjcmlwdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICBzY3JpcHQucmVtb3ZlKCk7XG4gICAgICB9KTtcblxuICAgICAgc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKCd4cmF5LXJlYWN0OiBGYWlsZWQgdG8gbG9hZCBTb2NrZXQuSU8gY2xpZW50IGxpYnJhcnknKTtcbiAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIHNjcmlwdC5yZW1vdmUoKTtcbiAgICAgIH0pO1xuXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgU29ja2V0LklPIGNvbm5lY3Rpb25cbiAgICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IFRydWUgaWYgY29ubmVjdGVkIHN1Y2Nlc3NmdWxseVxuICAgKi9cbiAgYXN5bmMgaW5pdCgpIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdy5pbyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGNvbnN0IGlzU3VjY2VzcyA9IGF3YWl0IHRoaXMuYWRkU2NyaXB0KCk7XG4gICAgICBpZiAoIWlzU3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFNvY2tldC5JTyA0LnggdXNlcyBpbygpIGluc3RlYWQgb2YgaW8uY29ubmVjdCgpXG4gICAgICB0aGlzLmNsaWVudCA9IHdpbmRvdy5pbyhnZXRJT0Nvbm5lY3RVUkwoKSwge1xuICAgICAgICB0cmFuc3BvcnRzOiBbJ3dlYnNvY2tldCcsICdwb2xsaW5nJ11cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbignY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgLy8gQ29ubmVjdGVkIHN1Y2Nlc3NmdWxseVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY2xpZW50Lm9uKCdkaXNjb25uZWN0JywgKCkgPT4ge1xuICAgICAgICAvLyBEaXNjb25uZWN0ZWQgZnJvbSBzZXJ2ZXJcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbignY29ubmVjdF9lcnJvcicsIChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLndhcm4oJ3hyYXktcmVhY3Q6IENvbm5lY3Rpb24gZXJyb3InLCBlcnJvcik7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5jbGllbnQub24oJ3Byb2plY3QtY29uZmlnJywgKGNvbmZpZykgPT4ge1xuICAgICAgICBpZiAoY29uZmlnKSB7XG4gICAgICAgICAgaWYgKGNvbmZpZy5wb3J0ICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB3aW5kb3cuX19YUkFZX1JFQUNUX1BPUlRfXyA9IGNvbmZpZy5wb3J0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY29uZmlnLm1vZGUgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGNvbnN0IG1vZGUgPSBBVkFJTEFCTEVfVUlfTU9ERVMuaW5jbHVkZXMoY29uZmlnLm1vZGUpID8gY29uZmlnLm1vZGUgOiBVSV9NT0RFX0ZVTEw7XG4gICAgICAgICAgICB3aW5kb3cuX19YUkFZX1JFQUNUX01PREVfXyA9IG1vZGU7XG4gICAgICAgICAgICBpZiAod2luZG93LnhyYXlSZWFjdFNldE1vZGUpIHtcbiAgICAgICAgICAgICAgd2luZG93LnhyYXlSZWFjdFNldE1vZGUobW9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjb25maWcucHJvamVjdFJvb3QpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cueHJheVJlYWN0U2V0UHJvamVjdFJvb3QpIHtcbiAgICAgICAgICAgICAgd2luZG93LnhyYXlSZWFjdFNldFByb2plY3RSb290KGNvbmZpZy5wcm9qZWN0Um9vdCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuX19YUkFZX1JFQUNUX1BST0pFQ1RfUk9PVF9fID0gY29uZmlnLnByb2plY3RSb290O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5jbGllbnQub24oJ3VzYWdlLW1hcCcsIChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEudXNhZ2UpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LnhyYXlSZWFjdFNldFVzYWdlTWFwKSB7XG4gICAgICAgICAgICB3aW5kb3cueHJheVJlYWN0U2V0VXNhZ2VNYXAoZGF0YS51c2FnZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICB3aW5kb3cuX19YUkFZX1JFQUNUX1VTQUdFX01BUF9fID0gZGF0YS51c2FnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbignaW1wb3J0LW1hcCcsIChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEuaW1wb3J0cykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cueHJheVJlYWN0U2V0SW1wb3J0TWFwKSB7XG4gICAgICAgICAgICB3aW5kb3cueHJheVJlYWN0U2V0SW1wb3J0TWFwKGRhdGEuaW1wb3J0cyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICB3aW5kb3cuX19YUkFZX1JFQUNUX0lNUE9SVF9NQVBfXyA9IGRhdGEuaW1wb3J0cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbigncHJvamVjdC1maWxlcycsIChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEuZmlsZXMpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LnhyYXlSZWFjdFNldFByb2plY3RGaWxlcykge1xuICAgICAgICAgICAgd2luZG93LnhyYXlSZWFjdFNldFByb2plY3RGaWxlcyhkYXRhLmZpbGVzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgIHdpbmRvdy5fX1hSQVlfUkVBQ1RfUFJPSkVDVF9GSUxFU19fID0gZGF0YS5maWxlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcigneHJheS1yZWFjdDogRmFpbGVkIHRvIGluaXRpYWxpemUgU29ja2V0LklPJywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEluaXRpYWxpemVzIFNvY2tldC5JTyBhbmQgc2V0cyB1cCBjbGljayBsaXN0ZW5lcnNcbiAqL1xuY29uc3QgaW5pdElPQW5kTGlzdGVuZXJzID0gYXN5bmMgKCkgPT4ge1xuICBjb25zdCBjbGllbnRJTyA9IG5ldyBDbGllbnRJTygpO1xuICBjb25zdCBpc1N1Y2Nlc3MgPSBhd2FpdCBjbGllbnRJTy5pbml0KCk7XG5cbiAgaWYgKGlzU3VjY2Vzcykge1xuICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKGNvbnN0YW50cy54cmF5UmVhY3RFbGVtQ04pKSB7XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudFBhdGggPSB0YXJnZXQuZ2V0QXR0cmlidXRlKGNvbnN0YW50cy54cmF5UmVhY3RDb21wUGF0aEF0dHIpO1xuICAgICAgICBpZiAoY29tcG9uZW50UGF0aCAmJiBjbGllbnRJTy5jbGllbnQpIHtcbiAgICAgICAgICBjbGllbnRJTy5jbGllbnQuZW1pdCgneHJheS1yZWFjdC1jb21wb25lbnQnLCBjb21wb25lbnRQYXRoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG59O1xuXG5pZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2xvYWRpbmcnKSB7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBpbml0SU9BbmRMaXN0ZW5lcnMpO1xufSBlbHNlIHtcbiAgaW5pdElPQW5kTGlzdGVuZXJzKCk7XG59XG4iXSwibmFtZXMiOlsiY29uc3RhbnRzLnhyYXlSZWFjdEVsZW1DTiIsImNvbnN0YW50cy54cmF5UmVhY3RDb21wUGF0aEF0dHIiXSwibWFwcGluZ3MiOiI7OztFQUFPLE1BQU0sZUFBZSxHQUFHLG9CQUFvQjtFQUU1QyxNQUFNLHFCQUFxQixHQUFHLGlDQUFpQzs7RUNGdEU7RUFDQTtFQUNBO0VBQ0E7OztFQUlPLE1BQU0sWUFBWSxHQUFHLE1BQU07RUFDM0IsTUFBTSxjQUFjLEdBQUcsUUFBUTtFQUMvQixNQUFNLGtCQUFrQixHQUFHLENBQUMsWUFBWSxFQUFFLGNBQWMsQ0FBQzs7RUNOaEUsTUFBTSxlQUFlLEdBQUcsTUFBTTtFQUM5QixFQUFFLE1BQU0sSUFBSSxHQUFHLENBQUMsT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLE1BQU0sQ0FBQyxtQkFBbUIsS0FBSyxJQUFJO0VBQ3BGLEVBQUUsT0FBTyxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxDQUFDO0VBQ25DLENBQUM7O0VBRUQ7RUFDQTtFQUNBO0VBQ0EsTUFBTSxRQUFRLENBQUM7RUFDZixFQUFFLFdBQVcsR0FBRztFQUNoQixJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSTtFQUN0QixFQUFFOztFQUVGO0VBQ0E7RUFDQTtFQUNBO0VBQ0EsRUFBRSxTQUFTLEdBQUc7RUFDZCxJQUFJLE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEtBQUs7RUFDcEMsTUFBTSxJQUFJLE9BQU8sTUFBTSxDQUFDLEVBQUUs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
